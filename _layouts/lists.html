---
layout: page
# Hierarchical list layout for Notes-like pages
---

{% include lang.html %}
{% assign top = page.top | default: page.title %}

<article class="mb-4">
  {{ content }}
</article>

{% assign group_index = 0 %}

{%- comment -%} 所有属于 top（如 "Notes"）的文章 {%- endcomment -%}
{% assign posts_all = site.posts | where_exp: "post", "post.categories and post.categories[0] == top" %}

{%- comment -%} 一级分类（categories[1]） {%- endcomment -%}
{% assign l1_all = "" | split: "" %}
{% for post in posts_all %}
  {% assign l1 = post.categories[1] %}
  {% if l1 and l1_all contains l1 %}
  {% elsif l1 %}
    {% assign l1_all = l1_all | push: l1 %}
  {% endif %}
{% endfor %}
{% assign l1_all = l1_all | sort %}

{% for l1 in l1_all %}
  {% assign sub_posts = posts_all | where_exp: "p", "p.categories[1] == l1" %}

  {%- comment -%} 二级分类（categories[2]） {%- endcomment -%}
  {% assign l2_all = "" | split: "" %}
  {% for p in sub_posts %}
    {% assign l2 = p.categories[2] %}
    {% if l2 and l2_all contains l2 %}
    {% elsif l2 %}
      {% assign l2_all = l2_all | push: l2 %}
    {% endif %}
  {% endfor %}
  {% assign l2_all = l2_all | sort %}

  {% capture _l1_url %}/{{ top | slugify | url_encode }}/{{ l1 | slugify | url_encode }}/{% endcapture %}
  {% assign l1_collapse_id = "L1-" | append: group_index %}

  <div class="card categories mb-3">
    <!-- 一级头部：整行折叠触发，只有文字是链接；左侧内边距接近 Chirpy 默认 -->
    <div class="card-header d-flex align-items-center justify-content-between l1-row"
         role="button"
         data-bs-toggle="collapse"
         data-bs-target="#{{ l1_collapse_id }}"
         aria-expanded="true"
         aria-controls="{{ l1_collapse_id }}">

      <div class="d-flex align-items-center">
        <!-- 文件夹图标（随状态变更） -->
        <i class="far fa-folder l1-folder-icon me-3"></i>

        <!-- 只有文字是链接；不铺满整行 -->
        <a href="{{ _l1_url | relative_url }}" class="l1-link text-decoration-none me-2">{{ l1 }}</a>

        <span class="text-muted small">
          {% if l2_all.size > 0 %}{{ l2_all.size }} categories,{% endif %}
          {{ sub_posts.size }} post{% if sub_posts.size > 1 %}s{% endif %}
        </span>
      </div>

      <!-- 右侧箭头（唯一箭头） -->
      <i class="fas fa-angle-right fa-fw l1-chevron"></i>
    </div>

    <!-- 一级内容 -->
    <div id="{{ l1_collapse_id }}" class="collapse show">
      <ul class="list-group">

        {%- comment -%} 直接挂在 L1 下的文章（无 L2） {%- endcomment -%}
        {% assign direct_posts = sub_posts | where_exp: "p", "p.categories.size < 3 or p.categories[2] == nil" %}
        {% for post in direct_posts %}
          <li class="list-group-item">
            <i class="far fa-file fa-fw"></i>
            <a href="{{ post.url | relative_url }}" class="mx-2">{{ post.title }}</a>
          </li>
        {% endfor %}

        {%- comment -%} L2 分类块 {%- endcomment -%}
        {% for l2 in l2_all %}
          {% assign posts_l2 = sub_posts | where_exp: "p", "p.categories[2] == l2" %}
          {% capture _l2_url %}/{{ top | slugify | url_encode }}/{{ l1 | slugify | url_encode }}/{{ l2 | slugify | url_encode }}/{% endcapture %}
          {% assign l2_collapse_id = "L2-" | append: group_index | append: "-" | append: forloop.index %}

          <li class="list-group-item">
            <!-- 二级整行触发器 -->
            <div class="d-flex align-items-center w-100 l2-row"
                 role="button"
                 data-bs-toggle="collapse"
                 data-bs-target="#{{ l2_collapse_id }}"
                 aria-expanded="false"
                 aria-controls="{{ l2_collapse_id }}">

              <!-- 左侧箭头 -->
              <i class="fas fa-chevron-right fa-fw l2-chevron me-3"></i>

              <!-- 文件夹图标 -->
              <i class="far fa-folder l2-folder-icon me-2"></i>

              <!-- 只有文字是链接；不铺满整行 -->
              <a href="{{ _l2_url | relative_url }}" class="l2-link text-decoration-none mx-1">{{ l2 }}</a>

              <!-- 右侧计数 -->
              <span class="text-muted small ms-auto">
                {{ posts_l2.size }} post{% if posts_l2.size > 1 %}s{% endif %}
              </span>
            </div>

            <!-- L2 下的文章（适度缩进） -->
            <ul class="list-group ms-3 mt-2 collapse" id="{{ l2_collapse_id }}">
              {% for post in posts_l2 %}
                <li class="list-group-item">
                  <i class="far fa-file fa-fw"></i>
                  <a href="{{ post.url | relative_url }}" class="mx-2">{{ post.title }}</a>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}

      </ul>
    </div>
  </div>

  {% assign group_index = group_index | plus: 1 %}
{% endfor %}

<style>
/* ——整体风格与间距优化—— */

/* 一级头部：左内边距更接近 Chirpy 默认（比 Bootstrap 默认略大） */
.card.categories > .card-header { padding-left: 1.5rem; } /* ≈ ps-4 */

/* 一级文件夹与文字的间距再大一点 */
.l1-folder-icon { margin-right: .875rem !important; } /* me-3 基础上再稳固一层 */

/* 二级：箭头与文件夹间距更大 */
.l2-chevron { margin-right: .75rem !important; }      /* 比 me-2 略大 */
.l2-folder-icon { margin-right: .5rem !important; }

/* 仅文字为链接，避免链接扩张成整行 */
.l1-link, .l2-link { display: inline; flex: 0 0 auto; }

/* 行点击手势 */
.l1-row, .l2-row { cursor: pointer; }

/* 箭头与文件夹的过渡动画：改为 0.3s */
.l1-chevron, .l2-chevron { transition: transform 0.3s ease; }
.l1-folder-icon, .l2-folder-icon { transition: color 0.3s ease; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // —— 链接点击：显式导航，确保一定跳转；支持 Ctrl/⌘ 新开标签 ——
  function handleLinkClick(e, a) {
    e.stopPropagation(); // 不触发展开/收起
    const href = a.getAttribute('href');
    if (!href) return;

    if (e.button === 1 || e.ctrlKey || e.metaKey) {
      // 中键或 Ctrl/⌘-点击：新开标签
      e.preventDefault();
      window.open(href, '_blank');
    } else {
      // 常规左键：显式导航，避免被上层行为干扰
      e.preventDefault();
      window.location.assign(href);
    }
  }
  document.querySelectorAll('.l1-link, .l2-link').forEach(function (a) {
    a.addEventListener('click', function (e) { handleLinkClick(e, this); });
  });

  // —— 角度映射 —— 
  // L1: 折叠=180°(向左)，展开=90°(向下)
  // L2: 折叠=0°(向右)，  展开=90°(向下)
  function angleFor(level, expanded) {
    if (level === 'l1') return expanded ? 90 : 180;
    return expanded ? 90 : 0; // l2
  }

  // 按当前状态同步（初始化 & 事件回调）
  function syncByState(targetEl, expanded) {
    const idSel = '#' + targetEl.id;
    document.querySelectorAll('[data-bs-target="' + idSel + '"]').forEach(function (row) {
      const isL1 = row.classList.contains('l1-row');
      const level = isL1 ? 'l1' : 'l2';
      const chev = row.querySelector(isL1 ? '.l1-chevron' : '.l2-chevron');
      const fol  = row.querySelector(isL1 ? '.l1-folder-icon' : '.l2-folder-icon');
      if (chev) chev.style.transform = 'rotate(' + angleFor(level, expanded) + 'deg)';
      if (fol) {
        fol.classList.toggle('fa-folder-open', expanded);
        fol.classList.toggle('fa-folder', !expanded);
      }
    });
  }

  // 初始状态：按是否含 .show 同步一次
  document.querySelectorAll('.collapse').forEach(function (el) {
    syncByState(el, el.classList.contains('show'));
  });

  // 使用“动画开始事件”而非“动画结束事件”，点击后立刻变化
  document.querySelectorAll('.collapse').forEach(function (el) {
    el.addEventListener('show.bs.collapse',  function (e) { syncByState(e.target, true);  });
    el.addEventListener('hide.bs.collapse',  function (e) { syncByState(e.target, false); });
  });
});
</script>
